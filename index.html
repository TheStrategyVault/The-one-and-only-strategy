<script>
    async function checkKey() {
        // Get the button and show a "loading" state
        const button = document.querySelector('.cta-button');
        button.textContent = 'Checking...';
        button.disabled = true;

        let userKey = prompt('Please enter your access key:');

        if (!userKey) {
            button.textContent = 'Unlock Course';
            button.disabled = false;
            return;
        }

        try {
            // This special URL points to the function we built.
            // It works automatically on Netlify.
            const response = await fetch('/.netlify/functions/check-key?key=' + userKey);
            const data = await response.json();

            if (data.isValid) {
                alert('Success! Accessing the course now.');
                window.location.href = 'course.html';
            } else {
                alert('Access Denied. This key is invalid or has already been used.');
                button.textContent = 'Unlock Course';
                button.disabled = false;
            }
        } catch (error) {
            alert('An error occurred. Please try again.');
            button.textContent = 'Unlock Course';
            button.disabled = false;
        }
    }
</script>
